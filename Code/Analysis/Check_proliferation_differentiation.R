library(Seurat)
library(ggplot2)


data_5q_annotated <- readRDS('/home/tereshkova/data/gserranos/MDS/Data/5qSamples_Annotated_final.rds')


DATASET_PATH = '/home/tereshkova/data/gserranos/MDS/Data/Genesets'
genes <- list()
for (fl in list.files(DATASET_PATH)){
	name <-  stringr::str_extract(fl, '[\\w]+(?=\\.)')
	genes[[name]] <- msigdbi::read.gmt(file.path(DATASET_PATH, fl))[1][[1]][[1]]
}


pdf('./Plots/PaperFigures/Proliferation_differentiation.pdf')
DefaultAssay(data_5q_annotated) <- 'SCT'
for( name in names(genes)){
	message(name)
	tmp <- AddModuleScore(data_5q_annotated, features = genes[name], name = name)
	plotter <- setNames(FetchData(tmp, vars = c('Sample', 'cell_5q', 'Cluster_names', paste0(name, '1'))), 
						c('Sample', 'cell_5q', 'Cluster_names', 'Score'))
	print(ggplot(plotter, aes(x=Cluster_names, y=Score, fill=cell_5q)) + 
	geom_boxplot() + facet_wrap(~Sample)  + ggtitle(name) + theme_classic() +
	ggpubr::stat_compare_means(aes(group=cell_5q), label = "p.signif", method="wilcox.test", hide.ns=FALSE, paired=F, label.y=1.3) + 
	theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position='bottom'))
}
dev.off()


LANDAU_DATA <- list()
LANDAU_DATA[['Cell_Cycle_module']] <- c('MCM5','PCNA','TYMS','FEN1','MCM2','MCM4','RRM1','UNG','GINS2','MCM6','CDCA7','DTL','PRIM1','UHRF1','MLF1IP','HELLS','RFC2','RPA2','NASP','RAD51AP1','GMNN','WDR76','SLBP','CCNE2','UBR7','POLD3','MSH2','ATAD2','RAD51','RRM2','CDC45','CDC6','EXO1','TIPIN','DSCC1','BLM','CASP8AP2','USP1','CLSPN','POLA1','CHAF1B','BRIP1','E2F8','HMGB2','CDK1','NUSAP1','UBE2C','BIRC5','TPX2','TOP2A','NDC80','CKS2','NUF2','CKS1B','MKI67','TMPO','CENPF','TACC3','FAM64A','SMC4','CCNB2','CKAP2L','CKAP2','AURKB','BUB1','KIF11','ANP32E','TUBB4B','GTSE1','KIF20B','HJURP','CDCA3','HN1','CDC20','TTK','CDC25C','KIF2C','RANGAP1','NCAPD2','DLGAP5','CDCA2','CDCA8','ECT2','KIF23','HMMR','AURKA','PSRC1','ANLN','LBR','CKAP5','CENPE','CTCF','NEK2','G2E3','GAS2L3','CBX5','CENPA')

LANDAU_DATA[['HSPC_module']] <- c('ARG2', 'ATP8B4', 'BIRC3', 'BST2', 'CD37', 'CD52', 'CEBPB', 'CLEC2B', 'COX6B1', 'CRHBP', 'CYBRD1', 'FAM198B', 'FAM30A', 'FOSB', 'GATA3', 'GBP2', 'GIMAP6', 'GUCY1A3', 'GUCY1B3', 'H1F0', 'HIST1H1C', 'HIST1H2AE', 'HIST1H2BC', 'HIST1H2BD', 'HIST1H2BF', 'HIST1H2BG', 'HIST1H2BK', 'HIST1H3D', 'HIST1H3H', 'HIST2H2AA3', 'HIST2H2BE', 'HLA-DQA1', 'HLA-DQB1', 'HLA-E', 'HLF', 'HOPX', 'HOXB3', 'HSPB1', 'IDI1', 'IDS', 'IL6ST', 'INPP4B', 'KIAA0125', 'KLF2', 'KLF4', 'LIMCH1', 'LOC144481', 'LOC283070', 'LOC404266', 'MECOM', 'MLLT3', 'MMRN1', 'MPL', 'NPR3', 'NRIP1', 'PBXIP1', 'PDGFD', 'PGM5', 'PLS3', 'PPM1F', 'PRKCH', 'RAPGEF2', 'RBPMS', 'ROBO4', 'SEC62', 'SPINK2', 'SPTBN1', 'TFPI', 'TIPARP', 'TNFSF10', 'TRIM8')

LANDAU_DATA[['IMP_module']] <- c('SELL','SPINK2','CD52','HOPX','SLC52A3','FUT6','AVPR1B','MBOAT7','AVP','HOXB5','PIK3IP1','RBPMS','KIAA1462','GBP2','CRHBP','MMP2','HTR1B','CD34','ADGRG6','DMKN','KIAA0125','PROM1','MZB1','FLT3','PRDM16','NPM2','HLA-E','RCSD1','PRKCZ','CSF3R','BMP4','BIN1','SCML4','JUP','GLIPR1','DUSP10','EMCN','NOXA1','C6orf141','ABLIM1','GNG11','COL5A1','PBXIP1','NOG','GATA3','SIGLEC17P','PRKCH','PREX2','VWA5A','GIMAP6','SLCO5A1','TMEM140','JAML','CTSF','C9orf139','SIGLEC15','PMEPA1','ACOX2','SNX33','ALS2CL','IFITM1','SEPP1','OXT','PDLIM2','BST2','SLC2A5','SCAMP5','TK1','TMEM92','SPINK2','TYMS','ASF1B','MDK','LYNX1','PKMYT1','HIST1H4C','PHGDH','TUBB','RRM2','PCNA','MCM7','FANCD2','LIG1','FEN1','TUBA1B','TYRO3','MCM4','MORC4','ACE','SELL','CDC45','KIAA1161','MFAP4','CD52','MYBL2','MCM3','ZWINT','TRIM47','KIAA0101','CHAF1A','MCM2','BATF3','GINS2','CENPH','AVP','TMEM106C','TCF19','NUSAP1','SPC25','RFC4','IL17D','MCM10','PKM','SKA3','RMI2','FAM111B')

LANDAU_DATA[['EP_module']] <- c('CA1', 'HBB', 'LMNA', 'CD36', 'BLVRB', 'APOE', 'RHAG', 'AHSP', 'PKLR', 'CNRIP1', 'KLF1', 'APOC1', 'KCNH2', 'CA2', 'FAM178B', 'FAM89A', 'REXO2', 'TFR2', 'SELENBP1', 'EPCAM', 'PLIN2', 'TGM2', 'CDH1', 'ADD2', 'GFI1B', 'GATA1', 'GPT', 'TMEM56', 'TFRC', 'UROD', 'EPB42', 'CAST', 'RFESD', 'ANK1', 'FECH', 'NFIA', 'MPC2', 'FBXO7', 'MYC', 'APOL4', 'SCPEP1', 'TMOD1', 'SLC39A8', 'S100A6', 'HBD', 'G0S2', 'A4GALT', 'ATPIF1', 'NDFIP2', 'LPCAT3', 'HBS1L', 'ALAD', 'SPTA1', 'CASP3', 'PRDX2', 'PNPO', 'UBAC1', 'HOOK1', 'HIGD1A', 'CTTN', 'HSD3B7', 'UBXN10', 'STRADB', 'TMEM14C', 'HES6', 'ELOVL6', 'GAD1', 'TPGS2', 'RAB3IL1', 'CDC42EP4', 'TXNL1', 'DNAJA4', 'CSF1', 'SMIM10', 'ALDH1A1', 'GLRX', 'ARV1', 'SLC25A21', 'FAM83D', 'SMIM1', 'FAM210B', 'GRTP1', 'SLC38A5', 'ACHE', 'MBOAT2', 'ITGB1', 'ZFP36L1', 'EPOR', 'TNFRSF25', 'OAT', 'TNFAIP6', 'CCT6A', 'KEL', 'HMBS', 'AK6', 'SLC25A15', 'ACSS1', 'ALAS2', 'SEC14L2', 'ENG', 'MINPP1', 'PCCB', 'FHL2', 'PPA2', 'PNMT', 'EMP3', 'SLC10A4', 'CXADR', 'MFSD2B')

LANDAU_DATA[['MkP_module']] <- c('GP1BB','PLEK','ITGA2B','FCER1A','GATA2','SELP','PDLIM1','SLC40A1','ARHGAP6','ABHD4','SOD2','C6orf25','AOAH','GMPR','RGS18','VWF','FERMT3','MINPP1','ALOX12','GFR1','ST6GAL2','ITGB3','GP1BA','PTGS1','ABCC4','HEMGN','BAG3','MPL','TRPC6','SLC9A9','PBX1','LTBP1','GUCY1B3','LAPTM4B','SEMA3C','TUBB1','RAMP1','TC2N','SETP5','IFITM2','PLXDC2','RAP1B','MEIS1','MED12L','GCSAML','PTAFR','GATA1','RNF130','SDPR','GP9','LIMS1','SLC44A1','RSU1','DEPTOR','CMTM5','DNM3','COL2A1','ANGPT1','FREM1','TMEM246','NME8','TIMP3','BIN2','F2RL3','TESPA1','ADRA2A','FAM65C','CD164','PIM1','NRIP1','FKBP10','IL1B','DAD1','TPST1','PRKCQ','TSPAN15','TPM1','ATP6V0A2','SLC10A5','EHD3','DHRS9','MGLL','LOX','CLU','AMHR2','ANXA3','ST8SIA6','FLI1','PROS1','GPR141','SERPINB1','VCL','EFNB2','SPX','KIFC3','DHRS3','RAB27B','SLA2','ZBTB16','WFDC1','DKK1','TMBIM1','CHST7','DFFB','DTD1','MPP1','ITPKA','PRKACB','TAGLN2','FAM150B','CD226','CD9','PPBP')

LANDAU_DATA[['NP_module']] <- c('MPO','RNASE2','ATP8B4','MPEG1','KCNE5','FAM46A','AKR7L','RAB32','CLEC5A','PCNX','TBC1D12','ATXN7L1','SERTAD2','SEPT1','RFX8','GPI','GJA9','HYOU1','SLC22A15','BTBD6','MT-ND6','SNX24','CD81','AFF2','FAM201A','AZU1','ELANE','PRTN3','CFD','SRGN','LYST','RNASE2','MS4A3','ANKRD18A','RNASE3','MPO','CTSG','SERPINB10','F13A1','HGF','MNDA','BZRAP1','CST7','CEBPA','CSTA','CPA3','CSF3R','PLPPR3','TPT1','LPO','KBTBD11','CALR','MT-ND1','CEBPD','LYZ','MT-ND6','MT-ND2','CLEC5A','FAM46A','FAM201A','NAP1L1','HAL','DIAPH2','RPL9','C1QTNF4','RGCC','LRP3','TLR4','SLC22A15','ERO1B','FUT4','B4GALT5','RAB32','MGST1','ATP8B4','RPS24','MARC1','RPS13','FAM101B','SLC17A9','HRH2','SLC2A5','RPS4X','CLEC11A','PIWIL4','CSGALNACT1','TMEM170B','RAB44','HOMER3','NOV','HIPK1','CERS6','CLEC12A','DENND4A','RPLP2','MT-ND3','CEBPE','NDRG1','TXLNGY','PABPC3','KCNJ9','ANKRD11','VAMP5','ALCAM','KIAA0930','CENPB','GRIP1','PABPC1','IRAK3','TNFSF13B','CHSY1','TLR2','ADRBK1','MYCBP2','POLR3B','APLP2','DDX17','DENND3','RPL28','IGFBP2','EREG','PRAM1','FCGR1A','ODF3B','RPL39','AIFM2','FAM120A','IGLL1','TSPAN16','RPS8','TOP1MT','PRSS57','LYZ','EGR1','CEBPD','CSTA','LGALS1','SAMHD1','KCNE5','FOSB','CFD','IGSF6','KIAA0930','LY86','MNDA','CSF1R','FOS','ANXA2','VIM','MS4A6A','RASSF4','ZFP36','RNASE2','STAB1','FOSL2','LYST','FGD2','IL17RA','MPO','MCL1','RAB31','TIFAB','MTMR11','RETN','HRH2','F13A1','CD93','IL6R','TYROBP','KLF4','PLAC8','MEF2D','IL13RA1','LILRB4','FGR','PRKCD','SERPINB8','KCTD12','CITED4','SRGN','HCST','CPM','PLD4','RHOU','SETD7','FCER1G','S100A9','GABARAP','JUN','TNFAIP2','TMSB10','MAPKAPK2','CSF2RA','CYBA','RNASE6','PRTN3','BZRAP1','TIMP2','IRF8','RBM47','AZU1','BRI3BP','GRN','CAPN3','S100A8','TYMP','KLF6','ATP8B4','CCR2','RAB11FIP1','NLRP3','MT-ND6','MYCBP2','FAM107B','SPI1','PRAM1','PTPRJ','NR4A2','ARHGEF40','SIRPA','SFMBT2','ITGB2','CHD3','NETO2','P2RY2','ODF3B','SERPINB2','NAIP','ZYX','PLB1','ADRBK1','SEMA4A','LST1','RPL28','CD48','GPR18','ZNF503','NT5DC2','SLC8A1','SIRPB2','NFAM1','CXCR4','KLF2','KLHDC7B','HNMT','CACNA2D3','AK4','ADRB2','LRRC8C','SLC17A9','RGCC','ZNF106','B3GNT7','GAS7','NKG7','TREM1','MBD2','CSGALNACT1','PTGIR','LPO','ENC1','HLA-DMB','TNFRSF1B','MS4A3','GPR183','WDR49')

LANDAU_DATA[['EBM_module']] <- c('CLC','HDC','PRG2','LMO4','BACE2','AKAP12','ALOX5AP','ANGPT2','ENPP3','GATA2','TPSB2','EPX','CXCR4','TPSAB1','MS4A2','ALOX5','NR4A3','TPSD1','LTBP1','HPGD','NTRK1','SLC18A2','LTC4S','SRGN','TPCN1','SLC45A3','CD63','TTLL7','ATP10D','VCAN','MS4A3','SYTL3','LYPD6B','ARSG','ERVFRD-1','FCER1A','TTC27','CSF2RB','CYP4F22','ETS1','NMT2','SEMA3C','ANXA1','TEF','ERN1','TMEM125','CERKL','SLC2A10','GLUL','KCNJ14','SLC24A3','PLD1','RGS2','SLC2A6','PNMAL2','RUNX1','ASRGL1','HIPK2','KDM6B','KCTD1','CKAP4','ZCCHC24','PDZK1IP1','NT5DC2','SLC4A8','DHRS9','PTGS2','JPH4','DLG5','DACT1','TNFRSF6B')

LANDAU_DATA[['PreB_module']] <- c('JCHAIN', 'DNTT', 'CD79A', 'LTB', 'MS4A1', 'VPREB1', 'DDIT4', 'LAT2', 'MME', 'BLNK', 'RASD1', 'TNFRSF4', 'CCR7', 'FCMR', 'CD22', 'DFNA5', 'UMODL1', 'IL7R', 'CNTNAP2', 'KCNK17', 'FAM129C', 'CAPG', 'SH2D3C', 'DUSP4', 'CLNK', 'EBF1', 'CYTH4', 'TMEM200A', 'LCN10', 'CYFIP2', 'CYGB', 'CD52', 'SATB1', 'STK17B', 'CORO1A', 'SH3TC1', 'IL2RA', 'FCRL1', 'SP140', 'MMP11', 'NCF1', 'SASH3', 'LGMN', 'CD79B', 'SLC43A2', 'NEGR1', 'ADA', 'HLA-DOB', 'ITGB7', 'LCK', 'ETS1', 'BLK', 'CD96', 'CCDC141', 'ROBO1', 'CRLF2', 'IL2RG', 'STAP1', 'CLEC2D', 'ARL4C', 'ID3', 'CD53', 'TP53I11', 'SOCS1', 'SLC9A3R1', 'SLC38A1', 'LY9', 'MZB1', 'EPB41L1', 'SH3BP5', 'ACY3', 'TNF', 'TNFAIP3', 'SPINK2', 'CAMK2D', 'RCSD1', 'PTPRCAP', 'SDK2', 'IL24', 'MN1', 'LRRC26', 'CLIP2', 'ID2', 'GPR150', 'FUT7', 'PRF1', 'SLC30A4', 'ITGA4', 'LAIR1', 'KIAA0125', 'PAG1', 'SCML4', 'TLE1', 'ITGAL', 'CEACAM21', 'MED13L', 'ARL5C', 'PPP1R18', 'CARD11', 'ARRDC3', 'ZAP70', 'SCN3A', 'SEPT1', 'HMHA1', 'CD200', 'FRMD4A', 'RGS1', 'KIF17', 'BIN1', 'ADD3', 'BAALC', 'ACTG1', 'MEF2A', 'LILRB1', 'TNFSF8', 'VPREB3', 'MTUS1', 'LSP1', 'NEIL1', 'S1PR1', 'CEACAM1', 'IQCA1', 'RDH5', 'SLC23A1', 'CXXC5', 'OLFML1', 'CCR10', 'C5orf56', 'DNAH10', 'TNC', 'ST6GALNAC2', 'PRKD2', 'SYNE1', 'ZFP37', 'EFNA4', 'GAS7', 'DGKA', 'SECTM1', 'CSRNP1', 'SPON2', 'ZNF608', 'AHRR', 'TRAF5', 'MDFIC', 'CD72', 'ZCCHC7', 'PIK3AP1', 'CYBB', 'EFNA1', 'HOPX', 'TLR10', 'LIME1', 'IPCEF1', 'LY86', 'SOX4', 'HS3ST3B1', 'NKD2', 'IL17RE', 'SHISA2', 'TMSB4XP4', 'DNTT', 'VPREB1', 'EBF1', 'HHIP', 'CTGF', 'BLNK', 'VPREB3', 'CYGB', 'ID3', 'UBASH3B', 'PLCH1', 'CLEC14A', 'LCK', 'MME', 'ATP13A4', 'IL7R', 'DDIT4', 'KLHL25', 'PVRIG', 'IGLL1', 'CHST15', 'TNF', 'PDE9A', 'GIMAP4', 'SH2D1A', 'NKAPL', 'SASH3', 'CLNK', 'SH3TC1', 'MTUS1', 'LTB', 'CD6', 'WFS1', 'LAT2', 'PLK2', 'SLC5A5', 'UMODL1', 'CD19', 'PHGDH', 'LPXN', 'ATF3', 'ZNF778', 'AKAP12', 'TMEM200A', 'SLFN5', 'CD79B', 'RAPGEF5', 'PAM', 'FAM134B', 'PRR19', 'ADA', 'BBC3', 'CD79A', 'ARPP21', 'GPR171', 'TCF4', 'P2RY10', 'CERS4', 'SLC43A2', 'CD52', 'RCSD1', 'HS3ST3B1', 'RASD1', 'NLRP12', 'FAM180B', 'ARL5C', 'BTBD6', 'CBX7', 'DFNA5', 'JCHAIN', 'NEGR1', 'SLC16A13', 'SMTN')





pdf('./Plots/PaperFigures/Proliferation_differentiation_LANDAU.pdf')
DefaultAssay(data_5q_annotated) <- 'SCT'
for( name in names(LANDAU_DATA)){
	message(name)
	tmp <- AddModuleScore(data_5q_annotated, features = LANDAU_DATA[name], name = name)
	plotter <- setNames(FetchData(tmp, vars = c('Sample', 'cell_5q', 'Cluster_names', paste0(name, '1'))), 
						c('Sample', 'cell_5q', 'Cluster_names', 'Score'))
	print(ggplot(plotter, aes(x=Cluster_names, y=Score, fill=cell_5q)) + 
	geom_boxplot() + facet_wrap(~Sample)  + ggtitle(name) + theme_classic() +
	ggpubr::stat_compare_means(aes(group=cell_5q), label = "p.signif", method="wilcox.test", hide.ns=FALSE, paired=F, label.y=1.3) + 
	theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position='bottom'))
}
dev.off()

